# Описание программируемой системы FinFlow

## Введение

FinFlow представляет собой комплексную микросервисную систему для управления групповыми финансами, предназначенную для упрощения процесса разделения расходов между участниками различных мероприятий. Система состоит из четырех основных микросервисов и мобильного приложения, обеспечивающих полный цикл управления пользователями, файлами и финансовыми операциями.

## Архитектура системы

Система FinFlow построена по микросервисной архитектуре и включает следующие компоненты:

**Серверная часть:**
- **ff-auth/ff-id** - сервис аутентификации и управления пользователями
- **ff-split** - основной сервис для управления групповыми расходами и мероприятиями
- **ff-files** - сервис для хранения и управления файлами

**Клиентская часть:**
- Мобильное приложение для конечных пользователей

**Инфраструктура:**
- PostgreSQL для хранения основных данных
- MinIO для хранения файлов
- Docker для контейнеризации сервисов

## Требования к программируемой системе

### Обязательные требования

1. **Язык программирования Go** - вся серверная логика реализована на языке Go версии 1.19 и выше, что обеспечивает высокую производительность и надежность системы.

2. **Корректность работы** - система поддерживает стабильный жизненный цикл от запуска до завершения, включая автоматическое восстановление после сбоев и корректную обработку ошибок.

3. **Интерфейс пользователя** - разработано мобильное приложение с интуитивно понятным пользовательским интерфейсом, включающим все необходимые инструкции и подсказки для работы.

4. **Инструкция по эксплуатации** - создана подробная документация по установке, настройке и использованию системы, включая описание API endpoints и примеры запросов.

### Дополнительные функциональные требования

5. **Микросервисная архитектура** - система должна быть разделена на независимые сервисы с четко определенными границами ответственности, что обеспечивает масштабируемость и возможность независимой разработки компонентов.

6. **Безопасность и аутентификация** - система должна обеспечивать надежную аутентификацию пользователей через JWT токены, контроль доступа на основе ролей и защиту API endpoints.

7. **Управление файлами** - система должна поддерживать загрузку, хранение и получение файлов различных форматов с возможностью управления правами доступа и автоматическим генерированием временных ссылок.

8. **Расчет групповых задолженностей** - система должна автоматически рассчитывать задолженности между участниками мероприятий с возможностью создания различных типов транзакций и справедливого распределения расходов.

9. **Контейнеризация и развертывание** - все компоненты системы должны быть контейнеризированы с использованием Docker и поддерживать развертывание через Docker Compose для упрощения установки и масштабирования.

## Описание алгоритма работы системы

### Общий алгоритм работы

Система FinFlow функционирует следующим образом:

1. **Инициализация системы**
   - Запуск всех микросервисов в контейнерах Docker
   - Инициализация подключений к базам данных PostgreSQL
   - Настройка хранилища файлов MinIO
   - Применение миграций базы данных

2. **Регистрация и аутентификация пользователя**
   - Пользователь регистрируется через мобильное приложение
   - Сервис ff-auth создает учетную запись и генерирует JWT токены
   - Система создает сессию пользователя и сохраняет информацию о входе

3. **Создание мероприятия**
   - Аутентифицированный пользователь создает новое мероприятие через сервис ff-split
   - Система создает запись мероприятия с указанием категории, описания и участников
   - Генерируется уникальный идентификатор мероприятия

4. **Управление участниками**
   - Добавление участников мероприятия по никнейму через сервис ff-id
   - Система проверяет существование пользователей и добавляет их к мероприятию
   - Настройка ролей и прав доступа участников

5. **Создание и управление расходами**
   - Участники добавляют расходы с указанием суммы, описания и категории
   - При необходимости прикрепляют файлы чеков через сервис ff-files
   - Система автоматически распределяет расходы между участниками

6. **Расчет задолженностей**
   - Система анализирует все транзакции мероприятия
   - Вычисляет баланс каждого участника
   - Генерирует оптимальные схемы погашения задолженностей

7. **Управление файлами**
   - Загрузка файлов в хранилище MinIO
   - Генерация временных подписанных ссылок для доступа
   - Автоматическое определение типов файлов и их валидация

### Алгоритм расчета задолженностей

Ключевой алгоритм системы - расчет задолженностей между участниками:

1. Сбор всех транзакций мероприятия из базы данных
2. Вычисление общей суммы расходов каждого участника
3. Определение справедливой доли каждого участника (общая сумма / количество участников)
4. Расчет баланса: потраченная сумма - справедливая доля
5. Группировка участников на должников (отрицательный баланс) и кредиторов (положительный баланс)
6. Оптимизация транзакций для минимизации количества переводов
7. Генерация списка рекомендуемых платежей

### Алгоритм обработки файлов

Сервис ff-files использует следующий алгоритм:

1. Получение файла от клиента через HTTP multipart запрос
2. Валидация размера и типа файла
3. Генерация уникального идентификатора объекта (UUID)
4. Автоматическое определение MIME-типа содержимого
5. Загрузка файла в хранилище MinIO
6. Генерация подписанной временной ссылки для доступа
7. Возврат идентификатора и ссылки клиенту

## Описание действий пользователя для работы с системой

### Первоначальная настройка

1. **Установка мобильного приложения**
   - Скачивание приложения FinFlow из магазина приложений
   - Запуск приложения на мобильном устройстве

2. **Регистрация в системе**
   - Заполнение регистрационной формы (email, пароль, никнейм, имя, телефон)
   - Подтверждение регистрации
   - Автоматический вход в систему

### Основные сценарии использования

#### Создание нового мероприятия

1. Нажатие кнопки "Создать мероприятие" в главном меню
2. Заполнение информации о мероприятии:
   - Название мероприятия
   - Выбор категории из предустановленного списка
   - Добавление описания
3. Сохранение мероприятия
4. Получение уникального кода мероприятия для приглашения участников

#### Добавление участников

1. Переход в раздел "Участники" созданного мероприятия
2. Использование одного из способов добавления:
   - Поиск по никнейму пользователя
   - Отправка приглашения по коду мероприятия
   - Импорт контактов из телефонной книги
3. Подтверждение добавления участников

#### Добавление расходов

1. Выбор мероприятия из списка активных
2. Нажатие кнопки "Добавить расход"
3. Заполнение данных о расходе:
   - Сумма расхода
   - Описание покупки
   - Выбор категории расхода
   - Выбор участников, между которыми будет разделен расход
4. Опционально - прикрепление фотографии чека:
   - Использование камеры для съемки чека
   - Выбор изображения из галереи
5. Сохранение расхода

#### Просмотр задолженностей

1. Переход в раздел "Балансы" мероприятия
2. Просмотр общей статистики:
   - Общая сумма расходов
   - Сумма расходов каждого участника
   - Справедливая доля каждого участника
3. Анализ индивидуальных балансов:
   - Просмотр кому и сколько должен пользователь
   - Просмотр кто и сколько должен пользователю
4. Использование рекомендаций системы для оптимального погашения долгов

#### Управление профилем

1. Переход в настройки профиля
2. Редактирование личной информации:
   - Изменение никнейма
   - Обновление имени и контактных данных
   - Смена пароля
3. Управление сессиями:
   - Просмотр активных устройств
   - Завершение сессий на других устройствах
4. Настройка уведомлений и конфиденциальности

### Дополнительные возможности

#### Работа с файлами

1. **Просмотр чеков и документов**
   - Нажатие на иконку файла рядом с расходом
   - Автоматическое открытие файла в приложении
   - Возможность увеличения и детального просмотра

2. **Управление загруженными файлами**
   - Просмотр списка всех файлов мероприятия
   - Удаление неактуальных файлов
   - Повторная загрузка поврежденных файлов

Система FinFlow обеспечивает интуитивно понятный пользовательский опыт, автоматизируя сложные финансовые расчеты и предоставляя удобные инструменты для управления групповыми расходами в режиме реального времени.

